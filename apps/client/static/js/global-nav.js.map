{"version":3,"file":"global-nav.js","sources":["global-nav.coffee"],"names":[],"mappings":"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","sourcesContent":["###\n<ul class=\"nav navbar-nav\" id=\"user_apps\" data-user-apps-url=\"#{ user-apps-url }\" data-app-uuid=\"\" data-logout-url=\"\"></ul>\n###\n\n$ ->\n  user_apps = $('#user_apps')\n  if user_apps.length > 0\n    user_apps_url = user_apps.data(\"user-apps-url\")\n    app_uuid = user_apps.data(\"app-uuid\")\n    user_uuid = user_apps.data(\"user-uuid\")\n    logout_url = user_apps.data(\"logout-url\")\n    if (user_apps_url isnt \"\") and (app_uuid isnt \"\") and (user_uuid isnt \"\")\n      add_user_apps_to_navbar(user_apps_url, app_uuid, logout_url, user_uuid)\n\n\nget_app_item = (app, app_uuid, dropdown = false) ->\n  css_class = if (app_uuid and app.id is app_uuid) then \"active\" else \"\"\n  if dropdown\n    return \"<li><a class=\\\"dropdown-item #{ css_class }\\\" href=\\\"#{ app.link.href }\\\">#{ app.link.title }</a></li>\"\n  else\n    return \"<li class=\\\"nav-item\\\"><a class=\\\"nav-link #{ css_class }\\\" href=\\\"#{ app.link.href }\\\">#{ app.link.title }</a></li>\"\n\n\nget_text = (data, key) ->\n  if data.text and data.text[key]\n    data.text[key]\n  else\n    key\n\n\nadd_user_apps_to_navbar = (user_app_url, app_uuid, logout_url, user_uuid) ->\n  url = user_app_url.replace(\"/me/\", \"/#{ user_uuid}/\")\n  request = $.ajax(\n    url: url,\n    dataType: \"jsonp\",\n    ifModified: true,\n    cache: true)\n\n  request.done((data) ->\n    if (data.error and data.code is 401) or (data.id isnt user_uuid)\n      # if logout_url\n      #  $(location).attr('href', logout_url)\n      console.debug(data.error)\n    else\n      items = []\n      apps = data.apps.filter((app) -> app.link.global_navigation)\n      more = get_text(data, 'More')\n      if apps.length < 4\n        $.each(apps, (idx, app) -> items.push(get_app_item(app, app_uuid)))\n      else\n        items.push(get_app_item(apps[i], app_uuid)) for i in [0..2]\n        subitems = [\"<li class=\\\"nav-item dropdown\\\"><a href=\\\"{ data.more.href }\\\" class=\\\"nav-link dropdown-toggle\\\" data-bs-toggle=\\\"dropdown\\\">#{ data.more.title }</a><ul class=\\\"dropdown-menu\\\">\"]\n        subitems.push(get_app_item(apps[i], app_uuid, true)) for i in [3..apps.length - 1]\n        subitems.push(\"</ul></li>\")\n        items.push(subitems.join(''))\n\n      $('#user_apps').html(items.join(''))\n\n      if data.picture_30x30\n        thumbnail = \"<img class=\\\"dwbn-icon-user\\\" width=\\\"30\\\" height=\\\"30\\\" alt=\\\"\\\" src=\\\"#{ data.picture_30x30.href }\\\">\"\n      else\n        thumbnail = \"<i class=\\\"glyphicon glyphicon-user\\\"></i>\"\n      profile_link = \"<a href=\\\"#{ data.profile.href }\\\">#{ thumbnail } #{ data.profile.title }</a>\"\n      $('#user-profile').html(profile_link)\n      $('#logout a span').text(data.logout.title)\n  )\n"]}